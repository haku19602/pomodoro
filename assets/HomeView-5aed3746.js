import{u as j}from"./list-38d4eba0.js";import{u as W}from"./settings-bb312967.js";import{g as B,o as R,a as U,n as D,u as T,b as E,r as C,w as F,c as x,s as I,d as q,e as H,f as w,V as $,h as d,i as z,j as V,t as P,k}from"./index-b8f014dd.js";import{V as O,a as J}from"./VRow-b16cfa8b.js";const K=""+new URL("tomato_leaf-b8967b6e.svg",import.meta.url).href;function A(e){return B()?(R(e),!0):!1}function _(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const r=()=>t(o);return A(r),{off:r}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(r=>r(...o)))}}function L(e){return typeof e=="function"?e():T(e)}const Q=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const X=Object.prototype.toString,Y=e=>X.call(e)==="[object Object]",Z=()=>{};function ee(e){return e||E()}function te(e,t=!0,n){const s=ee(n);s?U(e,s):t?e():D(e)}function ne(e){var t;const n=L(e);return(t=n==null?void 0:n.$el)!=null?t:n}const G=Q?window:void 0;function oe(...e){let t,n,s,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,s,o]=e,t=G):[t,n,s,o]=e,!t)return Z;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const r=[],a=()=>{r.forEach(u=>u()),r.length=0},v=(u,i,l,c)=>(u.addEventListener(i,l,c),()=>u.removeEventListener(i,l,c)),h=F(()=>[ne(t),L(o)],([u,i])=>{if(a(),!u)return;const l=Y(i)?{...i}:i;r.push(...n.flatMap(c=>s.map(g=>v(u,c,g,l))))},{immediate:!0,flush:"post"}),m=()=>{h(),a()};return A(m),m}function se(){const e=C(!1);return E()&&U(()=>{e.value=!0}),e}function re(e){const t=se();return x(()=>(t.value,!!e()))}function ie(e={}){const{window:t=G,requestPermissions:n=!0}=e,s=e,o=re(()=>!!t&&"Notification"in t),r=C(o.value&&"permission"in Notification&&Notification.permission==="granted"),a=C(null),v=async()=>{if(o.value)return!r.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(r.value=!0),r.value},{on:h,trigger:m}=_(),{on:u,trigger:i}=_(),{on:l,trigger:c}=_(),{on:g,trigger:N}=_(),y=async p=>{if(!o.value||!r.value)return;const f=Object.assign({},s,p);return a.value=new Notification(f.title||"",f),a.value.onclick=m,a.value.onshow=i,a.value.onerror=c,a.value.onclose=N,a.value},S=()=>{a.value&&a.value.close(),a.value=null};if(n&&te(v),A(S),o.value&&t){const p=t.document;oe(p,"visibilitychange",f=>{f.preventDefault(),p.visibilityState==="visible"&&S()})}return{isSupported:o,notification:a,ensurePermissions:v,permissionGranted:r,show:y,close:S,onClick:h,onShow:u,onError:l,onClose:g}}const fe={__name:"HomeView",setup(e){const t=j(),{currentItem:n,items:s,timeleft:o}=I(t),{setCurrentItem:r,countdown:a,setFinishedItem:v}=t,h=W(),{selectedAlarmFile:m,notify:u}=I(h),i={STOP:0,COUNTING:1,PAUSE:2},l=C(i.STOP);let c=0;const g=()=>{l.value===i.STOP&&s.value.length>0&&r(),l.value=i.COUNTING,c=setInterval(()=>{a(),o.value===0&&y()},1e3)},N=()=>{l.value=i.PAUSE,clearInterval(c)},y=()=>{clearInterval(c),l.value=i.STOP;const f=new Audio;if(f.src=m.value,f.play(),u.value){const{show:b,isSupported:M}=ie({title:"事項完成",body:n.value,icon:new URL(""+new URL("tomato-9be2b45c.png",import.meta.url).href,self.location).href});M.value&&b()}v(),s.value.length>0&&g()},S=x(()=>n.value.length>0?n.value:s.value.length>0?"點擊開始":"沒有事項"),p=x(()=>{const f=Math.floor(o.value/60).toString().padStart(2,"0"),b=(o.value%60).toString().padStart(2,"0");return f+":"+b});return(f,b)=>(q(),H($,{class:"tomato bg-red-darken-1 rounded-circle"},{default:w(()=>[d(z,{src:K,width:"300px",class:"leaf"}),d(J,{class:"text-center"},{default:w(()=>[d(O,{cols:"12"},{default:w(()=>[V("h1",null,P(S.value),1)]),_:1}),d(O,{cols:"12"},{default:w(()=>[V("h1",null,P(p.value),1)]),_:1}),d(O,{cols:"12"},{default:w(()=>[d(k,{variant:"text",icon:"mdi-play",disabled:l.value===i.COUNTING||T(n).length===0&&T(s).length===0,onClick:g},null,8,["disabled"]),d(k,{variant:"text",icon:"mdi-pause",disabled:l.value!==i.COUNTING,onClick:N},null,8,["disabled"]),d(k,{variant:"text",icon:"mdi-skip-next",disabled:T(n).length===0,onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1}))}};export{fe as default};
